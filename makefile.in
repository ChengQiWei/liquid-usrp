# Copyright (c) 2009, 2010, 2011 Joseph Gaeddert
# Copyright (c) 2009, 2010, 2011 Virginia Polytechnic
#                          Institute & State University
#
# This file is part of liquid.
#
# liquid is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# liquid is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with liquid.  If not, see <http://www.gnu.org/licenses/>.

# 
# Makefile for liquid SDR libraries, USRP applications
#
# Targets:
#    all  :  build all example programs
#

# paths
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
VPATH = @srcdir@
include_dirs	:= . include
vpath %.h $(include_dirs)

# programs
CC	:= @CC@
CXX	:= @CXX@
MV	:= mv -f
RM	:= rm -f
SED	:= sed
AR	:= ar
RANLIB	:= ranlib

##
## TARGET : all
##
all : examples


# flags
INCLUDE_CFLAGS	= $(addprefix -I ,$(include_dirs))
CFLAGS		+= $(INCLUDE_CFLAGS) -g -O2 -Wall -fPIC
CPPFLAGS	+= $(INCLUDE_CFLAGS) -g -O2 -Wall -fPIC
LDFLAGS		+= @LIBS@
ARFLAGS		= r

# example programs
example_src	:=			\
	src/flexframe_tx.cc		\
	src/packet_rx.cc		\
	src/packet_tx.cc		\
	src/ofdmframe_rx.cc		\

#	src/crdemo.cc
#	src/usrp_init_test.cc
#	src/usrp_io_test.cc
#	src/fmtx.cc 
#	src/framestats_rx.cc
#	src/framestats_tx.cc
#	src/gmsk_rx.cc
#	src/gmsk_tx.cc
#	src/jammer.cc
#	src/tx_rrc.cc
#	src/flexframe_rx.cc
#	src/iqpr_test.cc
#	src/ping.cc
#	src/ofdmframe_tx.cc
#	src/ofdmoqamframe_tx.cc
#	src/ofdmoqamframe_rx.cc
#	src/packetstream_rx.cc
#	src/packetstream_tx.cc
#	src/usrp_rx_gain_correction_test.cc
#	src/dsa_ofdmoqam.cc
#	src/firpfbch_tx.cc
#	src/tx_ofdmoqam.cc
#	src/cr.cc
#	src/test_usrp_standard_tx.cc
#	src/gr_usrp_rx_test.cc
#	src/ofdmoqamframe64_tx.cc
#	src/ofdmoqamframe64_rx.cc
#	src/gr_usrp_tx_test.cc

library_objs	= $(patsubst %.cc,%.o,$(library_src))
headers		= $(addprefix include/,$(library_headers))


##
## TARGET : examples
##

example_objs	= $(patsubst %.cc,%.o,$(example_src))
example_progs	= $(patsubst %.cc,%,  $(example_src))

$(example_objs) : %.o : %.cc
	$(CXX) $(CPPFLAGS) -c $< -o $@

$(example_progs) : % : %.o
	$(CXX) $(CPPFLAGS) $(LDFLAGS) $^ -o $@

examples: $(example_progs)

clean-examples:
	$(RM) $(example_objs)
	$(RM) $(example_progs)

##
## TARGET : clean
##
clean: clean-examples
	$(RM) $(library_objs)
