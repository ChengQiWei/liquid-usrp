#
# USRP tests makefile
#

# paths
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
VPATH = @srcdir@
include_dirs	:= . include
vpath %.h $(include_dirs)

# programs
CC	:= @CC@
CXX	:= @CXX@
MV	:= mv -f
RM	:= rm -f
SED	:= sed
AR	:= ar
RANLIB	:= ranlib

# flags
INCLUDE_CFLAGS	= $(addprefix -I ,$(include_dirs))
CFLAGS		+= $(INCLUDE_CFLAGS) -g -O2 -Wall -fPIC
CPPFLAGS	+= $(INCLUDE_CFLAGS) -g -O2 -Wall -fPIC
LDFLAGS		+= @LIBS@
ARFLAGS		= r

local_headers	:=		\
	iqpr.h			\
	usrp_io.h		\
	usrp_rx_gain_correction.h

local_src	:=		\
	@LEGACY_LIBS@		\
	iqpr.cc			\
	usrp_io.cc		\
	usrp_rx_gain_correction.cc

local_progs	:=			\
	src/usrp_init_test.cc		\
	src/usrp_io_test.cc		\
	src/fmtx.cc 			\
	src/jammer.cc 			\
	src/tx_rrc.cc			\
	src/flexframe_tx.cc 		\
	src/flexframe_rx.cc		\
	src/iqpr_test.cc		\
	src/packet_tx.cc 		\
	src/packet_rx.cc		\
	src/ping.cc			\
	src/ofdmframe64_tx.cc		\
	src/ofdmframe64_rx.cc		\
	src/ofdmoqamframe64_tx.cc	\
	src/ofdmoqamframe64_rx.cc	\
	src/firpfbch_tx.cc		\
	src/usrp_rx_gain_correction_test.cc
#	src/dsa_ofdmoqam.cc
#	src/tx_ofdmoqam.cc
#	src/cr.cc
#	src/test_usrp_standard_tx.cc
#	src/gr_usrp_rx_test.cc
#	src/gr_usrp_tx_test.cc

sources		= $(addprefix lib/,$(local_src))
objects		= $(patsubst %.cc,%.cc.o,$(sources))
programs	= $(patsubst %.cc,%,$(local_progs))
headers		= $(addprefix include/,$(local_headers))

all: $(programs)

$(objects): %.cc.o : %.cc $(headers)
	$(CXX) $(CPPFLAGS) -c $< -o $@

$(programs): % : %.cc $(objects)
	$(CXX) $(CPPFLAGS) $(objects) $(LDFLAGS) $< -o $@

clean:
	$(RM) $(objects)
	$(RM) $(programs)
